# Домашнее задание к занятию "7.4. Средства командной работы над инфраструктурой."

## Задача 1. Настроить terraform cloud (необязательно, но крайне желательно).

В это задании предлагается познакомиться со средством командой работы над инфраструктурой предоставляемым
разработчиками терраформа. 

1. Зарегистрируйтесь на [https://app.terraform.io/](https://app.terraform.io/).
(регистрация бесплатная и не требует использования платежных инструментов).
1. Создайте в своем github аккаунте (или другом хранилище репозиториев) отдельный репозиторий с
 конфигурационными файлами прошлых занятий (или воспользуйтесь любым простым конфигом).
1. Зарегистрируйте этот репозиторий в [https://app.terraform.io/](https://app.terraform.io/).
1. Выполните plan и apply. 

В качестве результата задания приложите снимок экрана с успешным применением конфигурации.

Даже после успешной регистрации через vpn сервис через портативное устройство, не удается пройти авторизацию для выполнения задания.

![Screen1](https://github.com/emilsuleymanov/devops-netology/blob/main/07-terraform-04-teamwork/screen1.png)

## Задача 2. Написать серверный конфиг для атлантиса. 

Смысл задания – познакомиться с документацией 
о [серверной](https://www.runatlantis.io/docs/server-side-repo-config.html) конфигурации и конфигурации уровня 
 [репозитория](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html).

Создай `server.yaml` который скажет атлантису:
1. Укажите, что атлантис должен работать только для репозиториев в вашем github (или любом другом) аккаунте.
1. На стороне клиентского конфига разрешите изменять `workflow`, то есть для каждого репозитория можно 
будет указать свои дополнительные команды. 
1. В `workflow` используемом по-умолчанию сделайте так, что бы во время планирования не происходил `lock` состояния.

Создай `atlantis.yaml` который, если поместить в корень terraform проекта, скажет атлантису:
1. Надо запускать планирование и аплай для двух воркспейсов `stage` и `prod`.
1. Необходимо включить автопланирование при изменении любых файлов `*.tf`.

В качестве результата приложите ссылку на файлы `server.yaml` и `atlantis.yaml`.

server.yaml
```#server.yaml
repos:
- id: github.com/emilsuleymanov/devops-netology

  workflow: terraflow
  apply_requirements: [approved, mergeable]

  allowed_overrides: [workflow]
  allow_custom_workflows: true

workflows:
  hinetology:
    plan: 
      steps:
        - init:
            extra_args: ["-lock=false"]
        - plan:
            extra_args: ["-lock=false"]
    apply:
      steps: [apply]
```
atlantis.yaml
```#atlantis.yaml
version: 3
projects:
- dir: terraflow
  workspace: stage
  autoplan:
    when_modified: ["../modules/**/*.tf", "*.tf*"]
    enabled: true
- dir: terraflow
  workspace: prod
  autoplan:
    when_modified: ["../modules/**/*.tf", "*.tf*"]
    enabled: true
```

## Задача 3. Знакомство с каталогом модулей. 

1. В [каталоге модулей](https://registry.terraform.io/browse/modules) найдите официальный модуль от aws для создания
`ec2` инстансов. 
2. Изучите как устроен модуль. Задумайтесь, будете ли в своем проекте использовать этот модуль или непосредственно 
ресурс `aws_instance` без помощи модуля?
3. В рамках предпоследнего задания был создан ec2 при помощи ресурса `aws_instance`. 
Создайте аналогичный инстанс при помощи найденного модуля.

В качестве результата задания приложите ссылку на созданный блок конфигураций. 

К сожалению, я не нашёл никаких модулей под YC, а AWS не дает регистрироваться в моём регионе.
Есть верифицированные модули, из таких по созданию `ec2` инстансов нашёл только [ec2-instance](https://registry.terraform.io/modules/terraform-aws-modules/ec2-instance/aws/latest), но его разработчик из Украины и он содержит снизу приписку: `Additional terms of use for users from Russia and Belarus`

---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
